<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/server/build.gradle">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/server/build.gradle" />
              <option name="originalContent" value="plugins {&#10;    id 'java'&#10;    id 'org.springframework.boot' version '3.2.1'&#10;    id 'io.spring.dependency-management' version '1.1.4'&#10;}&#10;&#10;group = 'com.koto-thing'&#10;version = '1.0.0'&#10;sourceCompatibility = '21'&#10;&#10;repositories {&#10;    mavenCentral()&#10;}&#10;&#10;dependencies {&#10;    implementation 'org.springframework.boot:spring-boot-starter-web'&#10;    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'&#10;    implementation 'org.springframework.boot:spring-boot-starter-security'  // 追加&#10;    implementation 'com.h2database:h2'  // ローカル開発用&#10;    runtimeOnly 'org.postgresql:postgresql'  // 本番環境用&#10;    testImplementation 'org.springframework.boot:spring-boot-starter-test'&#10;}&#10;&#10;tasks.named('test') {&#10;    useJUnitPlatform()&#10;}&#10;&#10;bootJar {&#10;    archiveFileName = 'opinion-helper-server.jar'&#10;    mainClass = 'koto_thing.JuenOpinionHelperApplication'&#10;}&#10;&#10;" />
              <option name="updatedContent" value="plugins {&#10;    id 'java'&#10;    id 'org.springframework.boot' version '3.2.1'&#10;    id 'io.spring.dependency-management' version '1.1.4'&#10;}&#10;&#10;group = 'com.koto-thing'&#10;version = '1.0.0'&#10;sourceCompatibility = '21'&#10;&#10;repositories {&#10;    mavenCentral()&#10;}&#10;&#10;dependencies {&#10;    implementation 'org.springframework.boot:spring-boot-starter-web'&#10;    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'&#10;    implementation 'org.springframework.boot:spring-boot-starter-security'  // 追加&#10;    implementation 'com.h2database:h2'  // ローカル開発用&#10;    runtimeOnly 'org.postgresql:postgresql'  // 本番環境用&#10;    testImplementation 'org.springframework.boot:spring-boot-starter-test'&#10;}&#10;&#10;tasks.named('test') {&#10;    useJUnitPlatform()&#10;}&#10;&#10;bootJar {&#10;    archiveFileName = 'opinion-helper-server.jar'&#10;    mainClass = 'koto_thing.JuenOpinionHelperApplication'&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/server/src/main/java/koto_thing/DataInitializer.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/server/src/main/java/koto_thing/DataInitializer.java" />
              <option name="originalContent" value="package koto_thing;&#10;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.CommandLineRunner;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.stereotype.Component;&#10;&#10;@Component&#10;public class DataInitializer implements CommandLineRunner {&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;    &#10;    @Autowired&#10;    private PasswordEncoder passwordEncoder;&#10;    &#10;    @Override&#10;    public void run(String... args) {&#10;        // 環境変数から管理者パスワードを取得（未設定の場合はランダム生成）&#10;        String adminPassword = System.getenv(&quot;ADMIN_PASSWORD&quot;);&#10;        &#10;        if (!userRepository.existsByUsername(&quot;admin&quot;)) {&#10;            User admin = new User();&#10;            admin.setUsername(&quot;admin&quot;);&#10;            &#10;            if (adminPassword == null || adminPassword.isEmpty()) {&#10;                // 環境変数が未設定の場合はランダムパスワードを生成&#10;                adminPassword = generateRandomPassword();&#10;                System.err.println(&quot;WARNING: ADMIN_PASSWORD not set!&quot;);&#10;                System.err.println(&quot;Generated random admin password: &quot; + adminPassword);&#10;                System.err.println(&quot;IMPORTANT: Save this password immediately!&quot;);&#10;            }&#10;            &#10;            admin.setPassword(passwordEncoder.encode(adminPassword));&#10;            userRepository.save(admin);&#10;            System.out.println(&quot;Admin user created successfully&quot;);&#10;        }&#10;    }&#10;    &#10;    private String generateRandomPassword() {&#10;        String chars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*&quot;;&#10;        StringBuilder password = new StringBuilder();&#10;        java.security.SecureRandom random = new java.security.SecureRandom();&#10;        for (int i = 0; i &lt; 16; i++) {&#10;            password.append(chars.charAt(random.nextInt(chars.length())));&#10;        }&#10;        return password.toString();&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package koto_thing;&#10;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.CommandLineRunner;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.stereotype.Component;&#10;&#10;@Component&#10;public class DataInitializer implements CommandLineRunner {&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;    &#10;    @Autowired&#10;    private PasswordEncoder passwordEncoder;&#10;    &#10;    @Override&#10;    public void run(String... args) {&#10;        // 環境変数から管理者パスワードを取得（未設定の場合はランダム生成）&#10;        String adminPassword = System.getenv(&quot;ADMIN_PASSWORD&quot;);&#10;        &#10;        System.out.println(&quot;=================================&quot;);&#10;        System.out.println(&quot;DataInitializer: Starting...&quot;);&#10;        System.out.println(&quot;ADMIN_PASSWORD env var set: &quot; + (adminPassword != null &amp;&amp; !adminPassword.isEmpty()));&#10;        &#10;        if (!userRepository.existsByUsername(&quot;admin&quot;)) {&#10;            User admin = new User();&#10;            admin.setUsername(&quot;admin&quot;);&#10;            &#10;            if (adminPassword == null || adminPassword.isEmpty()) {&#10;                // 環境変数が未設定の場合はランダムパスワードを生成&#10;                adminPassword = generateRandomPassword();&#10;                System.err.println(&quot;WARNING: ADMIN_PASSWORD not set!&quot;);&#10;                System.err.println(&quot;Generated random admin password: &quot; + adminPassword);&#10;                System.err.println(&quot;IMPORTANT: Save this password immediately!&quot;);&#10;            } else {&#10;                System.out.println(&quot;Using ADMIN_PASSWORD from environment variable&quot;);&#10;            }&#10;            &#10;            admin.setPassword(passwordEncoder.encode(adminPassword));&#10;            userRepository.save(admin);&#10;            System.out.println(&quot;Admin user created successfully&quot;);&#10;            System.out.println(&quot;  Username: admin&quot;);&#10;            System.out.println(&quot;  Password: &quot; + (adminPassword.length() &gt; 0 ? &quot;[SET]&quot; : &quot;[EMPTY]&quot;));&#10;        } else {&#10;            System.out.println(&quot;Admin user already exists - skipping creation&quot;);&#10;        }&#10;        &#10;        // 全ユーザーを表示&#10;        long userCount = userRepository.count();&#10;        System.out.println(&quot;Total users in database: &quot; + userCount);&#10;        System.out.println(&quot;=================================&quot;);&#10;    }&#10;    &#10;    private String generateRandomPassword() {&#10;        String chars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*&quot;;&#10;        StringBuilder password = new StringBuilder();&#10;        java.security.SecureRandom random = new java.security.SecureRandom();&#10;        for (int i = 0; i &lt; 16; i++) {&#10;            password.append(chars.charAt(random.nextInt(chars.length())));&#10;        }&#10;        return password.toString();&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>